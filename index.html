<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monitoring Pengambilan Part dari Mesin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    :root {
      --primary: #3b82f6;
      --secondary: #10b981;
      --accent: #f59e0b;
      --warning: #ef4444;
      --light: #f3f4f6;
      --dark: #1f2937;
    }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: white;
      display: flex;
      flex-direction: column;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .card-hover {
      transition: all 0.3s ease;
      transform: translateY(0);
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    thead th {
      background-color: rgba(255, 255, 255, 0.1);
      font-weight: 600;
    }
    tbody tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    .form-input, .form-select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      outline: none;
      transition: border-color 0.3s ease;
      width: 100%;
      margin-bottom: 15px;
    }
    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    .form-input:focus, .form-select:focus {
      border-color: var(--primary);
    }
    .form-select option {
      background-color: var(--dark);
      color: white;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 1000;
    }
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    .modal-content {
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 30px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }
    .modal.show .modal-content {
      transform: translateY(0);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 {
      font-size: 1.75rem;
      font-weight: bold;
      color: white;
    }
    .modal-close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }
    .modal-close-btn:hover {
      opacity: 1;
    }
    .modal-footer {
      text-align: right;
      margin-top: 20px;
    }
    .modal-footer button {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .btn-cancel {
      background-color: rgba(255,255,255,0.2);
      color: white;
      margin-right: 10px;
    }
    .btn-cancel:hover {
      background-color: rgba(255,255,255,0.3);
    }
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background-color: #2563eb;
    }
    .action-cell {
      position: relative;
      text-align: center;
    }
    .action-button {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }
    .action-button:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .action-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      min-width: 120px;
      z-index: 10;
      overflow: hidden;
      display: none;
      transform: translateY(5px);
      opacity: 0;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .action-menu.show {
      display: block;
      transform: translateY(0);
      opacity: 1;
    }
    .action-menu button {
      display: block;
      width: 100%;
      padding: 10px 15px;
      text-align: left;
      background: none;
      border: none;
      color: #333;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    .action-menu button:hover {
      background-color: var(--primary);
      color: white;
    }
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-new {
      background: var(--secondary);
      color: white;
    }
    .status-monitor {
      background: var(--accent);
      color: white;
    }
    .status-warning {
      background: var(--warning);
      color: white;
    }
  </style>
</head>
<body>
  <div class="max-w-7xl mx-auto w-full">
    <div class="glass-effect p-6 mb-6 text-center">
      <h1 class="text-3xl font-bold text-white mb-2">
        Monitoring Pengambilan Part dari Mesin
      </h1>
      <p class="text-white/80">Sistem tracking pengambilan part mesin</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="card-hover bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
        <div class="text-2xl font-bold mb-2" id="stat-mesin">0</div>
        <div class="text-sm">Total Mesin</div>
      </div>
      <div class="card-hover bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
        <div class="text-2xl font-bold mb-2" id="stat-part">0</div>
        <div class="text-sm">Total Part Dicopot</div>
      </div>
      <div class="card-hover bg-gradient-to-br from-yellow-500 to-yellow-600 p-6 rounded-xl text-white">
        <div class="text-2xl font-bold mb-2" id="stat-monitor">0</div>
        <div class="text-sm">Part Monitor</div>
      </div>
      <div class="card-hover bg-gradient-to-br from-red-500 to-red-600 p-6 rounded-xl text-white">
        <div class="text-2xl font-bold mb-2" id="stat-warning">0</div>
        <div class="text-sm">Part Perhatian</div>
      </div>
    </div>

    <div class="glass-effect p-6 mb-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-white">Data Mesin</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-white">
          <thead class="bg-white/10">
            <tr>
              <th class="px-4 py-3 text-left">Nama Mesin</th>
              <th class="px-4 py-3 text-left">Serial Number</th>
              <th class="px-4 py-3 text-left">Tanggal Input</th>
              <th class="px-4 py-3 text-left">Jumlah Part</th>
              <th class="px-4 py-3 text-left">Status Part</th>
              <th class="px-4 py-3 text-left">Note</th>
              <th class="px-4 py-3 text-left"></th>
            </tr>
          </thead>
          <tbody id="mesin-table-body">
            <tr>
              <td colspan="7" class="px-4 py-8 text-center text-white/60">
                <i class="fas fa-cogs text-3xl mb-2"></i>
                <p>Belum ada data mesin</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="glass-effect p-6 mb-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-white">Data Part Dicopot</h2>
        <!-- Tombol tambah part dihilangkan -->
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <select id="filter-mesin" class="px-4 py-2 rounded-lg bg-white/90 border-none focus:ring-2 focus:ring-blue-400 outline-none text-gray-800">
          <option value="">Semua Mesin</option>
        </select>
        <select id="filter-sn" class="px-4 py-2 rounded-lg bg-white/90 border-none focus:ring-2 focus:ring-blue-400 outline-none text-gray-800">
          <option value="">Semua SN Mesin</option>
        </select>
        <input type="date" id="filter-date-from" class="px-4 py-2 rounded-lg bg-white/90 border-none focus:ring-2 focus:ring-blue-400 outline-none text-gray-800" />
        <input type="date" id="filter-date-to" class="px-4 py-2 rounded-lg bg-white/90 border-none focus:ring-2 focus:ring-blue-400 outline-none text-gray-800" />
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-white">
          <thead class="bg-white/10">
            <tr>
              <th class="px-4 py-3 text-left">Part Number</th>
              <th class="px-4 py-3 text-left">Nama Part</th>
              <th class="px-4 py-3 text-left">Mesin</th>
              <th class="px-4 py-3 text-left">SN</th>
              <th class="px-4 py-3 text-left">Tanggal Dicopot</th>
              <th class="px-4 py-3 text-left">Tujuan</th>
              <th class="px-4 py-3 text-left">Note</th>
              <th class="px-4 py-3 text-left"></th>
            </tr>
          </thead>
          <tbody id="part-table-body">
            <tr>
              <td colspan="8" class="px-4 py-8 text-center text-white/60">
                <i class="fas fa-microchip text-3xl mb-2"></i>
                <p>Belum ada data part</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const mesinData = [
      { id: "m1", nama: "Picoplus", sn: "PC424M017", tanggalInput: "2025-07-31", note: "Mesin utama di lantai 1" },
      { id: "m2", nama: "Mesin Beta", sn: "MB2024X01", tanggalInput: "2024-06-15", note: "Mesin cadangan" }
    ];
    const partData = [
      { id: "p1", mesinId: "m1", partNumber: "PN-A123", nama: "Modul Sensor X", tanggalPencopotan: "2024-01-10", tujuan: "Perbaikan", note: "Kerusakan internal" },
      { id: "p2", mesinId: "m1", partNumber: "PN-B456", nama: "Kipas Pendingin", tanggalPencopotan: "2024-02-20", tujuan: "Gudang", note: "Penggantian rutin" },
      { id: "p3", mesinId: "m1", partNumber: "PN-C789", nama: "Power Supply", tanggalPencopotan: "2024-03-01", tujuan: "Perbaikan", note: "Tidak ada daya" },
      { id: "p4", mesinId: "m1", partNumber: "PN-D001", nama: "Lensa Optik", tanggalPencopotan: "2024-04-15", tujuan: "Kalibrasi", note: "Fokus buram" },
      { id: "p5", mesinId: "m1", partNumber: "PN-E002", nama: "Motor Stepper", tanggalPencopotan: "2024-05-20", tujuan: "Perbaikan", note: "Gerakan tidak presisi" },
      { id: "p6", mesinId: "m1", partNumber: "PN-F003", nama: "Filter Udara", tanggalPencopotan: "2024-06-01", tujuan: "Penggantian", note: "Tersumbat debu" },
      { id: "p7", mesinId: "m2", partNumber: "PN-G007", nama: "Sensor Tekanan", tanggalPencopotan: "2024-06-10", tujuan: "Perbaikan", note: "Sensor rusak" }
    ];

    const statMesin = document.getElementById("stat-mesin");
    const statPart = document.getElementById("stat-part");
    const statMonitor = document.getElementById("stat-monitor");
    const statWarning = document.getElementById("stat-warning");
    const mesinTableBody = document.getElementById("mesin-table-body");
    const partTableBody = document.getElementById("part-table-body");
    const filterMesin = document.getElementById("filter-mesin");
    const filterSn = document.getElementById("filter-sn");
    const filterDateFrom = document.getElementById("filter-date-from");
    const filterDateTo = document.getElementById("filter-date-to");

    function renderStats() {
      statMesin.textContent = mesinData.length;
      statPart.textContent = partData.length;
      // Contoh logika: part monitor = part jumlah 1-3, perhatian >3
      let monitorCount = 0;
      let warningCount = 0;
      mesinData.forEach(mesin => {
        const count = partData.filter(p => p.mesinId === mesin.id).length;
        if (count > 3) warningCount++;
        else if (count > 0) monitorCount++;
      });
      statMonitor.textContent = monitorCount;
      statWarning.textContent = warningCount;
    }

    function renderMesinTable() {
      mesinTableBody.innerHTML = "";
      if (mesinData.length === 0) {
        mesinTableBody.innerHTML = `<tr><td colspan="7" class="px-4 py-8 text-center text-white/60">
          <i class="fas fa-cogs text-3xl mb-2"></i><p>Belum ada data mesin</p></td></tr>`;
        return;
      }
      mesinData.forEach(mesin => {
        const jumlahPart = partData.filter(p => p.mesinId === mesin.id).length;
        const status = jumlahPart > 3 ? "Perhatian" : (jumlahPart > 0 ? "Monitor" : "Baru");
        const statusClass = jumlahPart > 3 ? "status-warning" : (jumlahPart > 0 ? "status-monitor" : "status-new");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-4 py-3">${mesin.nama}</td>
          <td class="px-4 py-3">${mesin.sn}</td>
          <td class="px-4 py-3">${mesin.tanggalInput}</td>
          <td class="px-4 py-3">${jumlahPart}</td>
          <td class="px-4 py-3"><span class="status-badge ${statusClass}">${status}</span></td>
          <td class="px-4 py-3">${mesin.note || ""}</td>
          <td class="px-4 py-3 action-cell">
            <button class="action-button" onclick="openMesinMenu(event, '${mesin.id}')"><i class="fas fa-ellipsis-v"></i></button>
            <div class="action-menu" id="mesin-menu-${mesin.id}">
              <button onclick="viewMesin('${mesin.id}')">Lihat</button>
              <button onclick="editMesin('${mesin.id}')">Edit</button>
              <button onclick="deleteMesin('${mesin.id}')">Hapus</button>
            </div>
          </td>
        `;
        mesinTableBody.appendChild(row);
      });
    }

    function renderPartTable(filtered = null) {
      partTableBody.innerHTML = "";
      const list = filtered || partData;
      if (list.length === 0) {
        partTableBody.innerHTML = `<tr><td colspan="8" class="px-4 py-8 text-center text-white/60">
          <i class="fas fa-microchip text-3xl mb-2"></i><p>Belum ada data part</p></td></tr>`;
        return;
      }
      list.forEach(part => {
        const mesin = mesinData.find(m => m.id === part.mesinId) || { nama: "-", sn: "-" };
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-4 py-3">${part.partNumber}</td>
          <td class="px-4 py-3">${part.nama}</td>
          <td class="px-4 py-3">${mesin.nama}</td>
          <td class="px-4 py-3">${mesin.sn}</td>
          <td class="px-4 py-3">${part.tanggalPencopotan}</td>
          <td class="px-4 py-3">${part.tujuan}</td>
          <td class="px-4 py-3">${part.note}</td>
          <td class="px-4 py-3 action-cell">
            <button class="action-button" onclick="openPartMenu(event, '${part.id}')"><i class="fas fa-ellipsis-v"></i></button>
            <div class="action-menu" id="part-menu-${part.id}">
              <button onclick="viewPart('${part.id}')">Lihat</button>
              <button onclick="editPart('${part.id}')">Edit</button>
              <button onclick="deletePart('${part.id}')">Hapus</button>
            </div>
          </td>
        `;
        partTableBody.appendChild(row);
      });
    }

    function populateFilters() {
      filterMesin.innerHTML = '<option value="">Semua Mesin</option>';
      filterSn.innerHTML = '<option value="">Semua SN Mesin</option>';
      mesinData.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m.id;
        opt.textContent = `${m.nama}`;
        filterMesin.appendChild(opt);

        const opt2 = document.createElement("option");
        opt2.value = m.sn;
        opt2.textContent = m.sn;
        filterSn.appendChild(opt2);
      });
    }

    function openMesinMenu(e, id) {
      e.stopPropagation();
      closeAllMenus();
      const menu = document.getElementById(`mesin-menu-${id}`);
      menu.classList.add("show");
    }
    function openPartMenu(e, id) {
      e.stopPropagation();
      closeAllMenus();
      const menu = document.getElementById(`part-menu-${id}`);
      menu.classList.add("show");
    }
    function closeAllMenus() {
      document.querySelectorAll(".action-menu").forEach(m => m.classList.remove("show"));
    }
    window.addEventListener("click", closeAllMenus);

    function viewMesin(id) {
      alert("Lihat mesin: " + id);
    }
    function editMesin(id) {
      alert("Edit mesin: " + id);
    }
    function deleteMesin(id) {
      const idx = mesinData.findIndex(m => m.id === id);
      if (idx > -1) {
        if (confirm("Hapus mesin ini?")) {
          mesinData.splice(idx, 1);
          renderAll();
        }
      }
    }

    function viewPart(id) {
      alert("Lihat part: " + id);
    }
    function editPart(id) {
      alert("Edit part: " + id);
    }
    function deletePart(id) {
      const idx = partData.findIndex(p => p.id === id);
      if (idx > -1) {
        if (confirm("Hapus part ini?")) {
          partData.splice(idx, 1);
          renderAll();
        }
      }
    }

    function applyFilters() {
      const mesinId = filterMesin.value;
      const sn = filterSn.value;
      const from = filterDateFrom.value;
      const to = filterDateTo.value;
      let filtered = partData.slice();
      if (mesinId) filtered = filtered.filter(p => p.mesinId === mesinId);
      if (sn) filtered = filtered.filter(p => (mesinData.find(m => m.id === p.mesinId) || {}).sn === sn);
      if (from) filtered = filtered.filter(p => p.tanggalPencopotan >= from);
      if (to) filtered = filtered.filter(p => p.tanggalPencopotan <= to);
      renderPartTable(filtered);
    }

    function renderAll() {
      renderStats();
      renderMesinTable();
      renderPartTable();
      populateFilters();
    }

    // Inisialisasi
    renderAll();
  </script>
</body>
</html>
